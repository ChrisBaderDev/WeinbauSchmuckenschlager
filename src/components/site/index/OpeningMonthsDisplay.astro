---
import { getEntry } from "astro:content";

const openingData = await getEntry("openingMonths", "openingMonths");
const allMonths = openingData?.data ?? [];

// Map German months to numbers for comparison
const monthMap: Record<string, number> = {
  "Januar": 0, "Februar": 1, "MÃ¤rz": 2, "April": 3,
  "Mai": 4, "Juni": 5, "Juli": 6, "August": 7,
  "September": 8, "Oktober": 9, "November": 10, "Dezember": 11
};

const now = new Date();
const currentMonth = now.getMonth();
const currentYear = now.getFullYear();

// Sort by year and month
const sorted = [...allMonths].sort((a, b) => {
  if (a.year !== b.year) return a.year - b.year;
  return monthMap[a.month] - monthMap[b.month];
});

// Find upcoming months (including current if it exists)
const upcoming = sorted.filter(m => {
  const mIndex = monthMap[m.month];
  return m.year > currentYear || (m.year === currentYear && mIndex >= currentMonth);
});

// If we have 3+ upcoming, use those. Otherwise, take last 3 from sorted list.
const displayMonths = upcoming.length >= 3 
  ? upcoming.slice(0, 3) 
  : sorted.slice(-3);
---

<div class="flex flex-row justify-around items-start w-full py-10  gap-8">
  {displayMonths.map((m) => (
    <div class="flex flex-col items-center text-center w-1/3">
      <h3 class="text-2xl mb-4">{m.month}</h3>
      <p class="text-sm">{m.startDate}</p>
      <p class="text-sm text-gray-400">-</p>
      <p class="text-sm">{m.endDate}</p>
    </div>
  ))}
</div>