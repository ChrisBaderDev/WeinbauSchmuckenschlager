---
import { getEntry } from "astro:content";
import { Image } from "astro:assets";
import LeseImage from "../../../assets/images/Lese.webp";
import HorizontalLine from "../../animation/HorizontalLine.astro";

const winesEntry = await getEntry("wines", "wines");
const wines = winesEntry?.data ?? [];
---

<section>
  <!-- Section Heading  -->
  <HorizontalLine direction="right" color="black" width="100%" />
  <div class="relative">
    <Image class="w-full object-cover h-100" src={LeseImage} alt="Lese" />
    <div class="absolute inset-0 flex items-center justify-center bg-black/40">
      <h2 class="text-white text-4xl fade-up">Unsere Weine</h2>
    </div>
  </div>
  <!-- Wine Slide Gallery -->
  <HorizontalLine direction="left" color="black" width="100%" />
  <div class="relative group">
    <!-- Left Button -->
    <button
      id="wine-prev"
      class="absolute left-2 top-1/2 -translate-y-1/2 z-10 w-10 h-10 bg-white/80 hover:bg-white border border-gray-300 rounded-full flex items-center justify-center hover:cursor-pointer transition-opacity opacity-0 group-hover:opacity-100"
      aria-label="Zurück"
    >
      ←
    </button>

    <!-- Scroll Container -->
    <div
      id="wine-gallery"
      class="flex gap-4 overflow-x-auto snap-x snap-mandatory scroll-smooth mx-4 py-12"
      style="scrollbar-width: none;"
    >
      {
        wines.map((wine: any) => (
          <a
            class="wine-card shrink-0 snap-start flex flex-col w-[calc((100%-1rem)/2)] md:w-[calc((100%-2rem)/3)] lg:w-[calc((100%-4rem)/5)]"
            href="https://www.shop-weinbau-schmuckenschlager.com/"
          >
            <div class="h-64 md:h-72 lg:h-120 overflow-hidden">
              <Image
                src={wine.image}
                alt={wine.name}
                class="w-full h-full object-contain object-top transition-transform duration-300 hover:-translate-y-2"
                quality={85}
                format="webp"
                loading="lazy"
                width={400}
              />
            </div>
            <div class="mt-3 text-center">
              <h3 class="text-xl">{wine.name}</h3>
              <p class="text-neutral-500">{wine.year}</p>
            </div>
          </a>
        ))
      }
    </div>

    <!-- Right Button -->
    <button
      id="wine-next"
      class="absolute right-2 top-1/2 -translate-y-1/2 z-10 w-10 h-10 bg-white/80 hover:bg-white border border-gray-300 rounded-full flex items-center justify-center hover:cursor-pointer transition-opacity opacity-0 group-hover:opacity-100"
      aria-label="Weiter"
    >
      →
    </button>
  </div>
</section>

<script>
  const gallery = document.getElementById("wine-gallery");
  const prevBtn = document.getElementById("wine-prev");
  const nextBtn = document.getElementById("wine-next");

  if (gallery && prevBtn && nextBtn) {
    const getScrollAmount = () => {
      const card = gallery.querySelector(".wine-card") as HTMLElement;
      if (!card) return 300;
      const style = getComputedStyle(gallery);
      const gap = parseFloat(style.gap) || 16;
      return card.offsetWidth + gap;
    };

    prevBtn.addEventListener("click", () => {
      gallery.scrollBy({ left: -getScrollAmount() * 2, behavior: "smooth" });
    });

    nextBtn.addEventListener("click", () => {
      gallery.scrollBy({ left: getScrollAmount() * 2, behavior: "smooth" });
    });
  }
</script>